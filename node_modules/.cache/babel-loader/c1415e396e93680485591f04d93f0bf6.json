{"ast":null,"code":"\"use strict\";\n\nvar _slicedToArray = require(\"/Users/samticknor/Portfolio-Site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray\");\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TikTokEmbed = void 0;\nvar classnames_1 = __importDefault(require(\"classnames\"));\nvar react_1 = __importDefault(require(\"react\"));\nvar react_sub_unsub_1 = require(\"react-sub-unsub\");\nvar useFrame_1 = require(\"../hooks/useFrame\");\nvar PlaceholderEmbed_1 = require(\"../placeholder/PlaceholderEmbed\");\nvar uuid_1 = require(\"../uuid\");\nvar EmbedStyle_1 = require(\"./EmbedStyle\");\nvar embedJsScriptSrc = 'https://www.tiktok.com/embed.js';\nvar minPlaceholderWidth = 325;\nvar maxPlaceholderWidth = 480;\nvar defaultPlaceholderHeight = 550;\nvar borderRadius = 8;\n// Embed Stages\nvar PROCESS_EMBED_STAGE = 'process-embed';\nvar CONFIRM_EMBED_SUCCESS_STAGE = 'confirm-embed-success';\nvar RETRYING_STAGE = 'retrying';\nvar EMBED_SUCCESS_STAGE = 'embed-success';\nvar TikTokEmbed = function TikTokEmbed(_a) {\n  var _b, _c;\n  var url = _a.url,\n    width = _a.width,\n    height = _a.height,\n    _a$linkText = _a.linkText,\n    linkText = _a$linkText === void 0 ? 'View post on TikTok' : _a$linkText,\n    placeholderImageUrl = _a.placeholderImageUrl,\n    placeholderSpinner = _a.placeholderSpinner,\n    _a$placeholderSpinner = _a.placeholderSpinnerDisabled,\n    placeholderSpinnerDisabled = _a$placeholderSpinner === void 0 ? false : _a$placeholderSpinner,\n    placeholderProps = _a.placeholderProps,\n    embedPlaceholder = _a.embedPlaceholder,\n    _a$placeholderDisable = _a.placeholderDisabled,\n    placeholderDisabled = _a$placeholderDisable === void 0 ? false : _a$placeholderDisable,\n    _a$scriptLoadDisabled = _a.scriptLoadDisabled,\n    scriptLoadDisabled = _a$scriptLoadDisabled === void 0 ? false : _a$scriptLoadDisabled,\n    _a$retryDelay = _a.retryDelay,\n    retryDelay = _a$retryDelay === void 0 ? 5000 : _a$retryDelay,\n    _a$retryDisabled = _a.retryDisabled,\n    retryDisabled = _a$retryDisabled === void 0 ? false : _a$retryDisabled,\n    _a$frame = _a.frame,\n    frame = _a$frame === void 0 ? undefined : _a$frame,\n    _a$debug = _a.debug,\n    debug = _a$debug === void 0 ? false : _a$debug,\n    divProps = __rest(_a, [\"url\", \"width\", \"height\", \"linkText\", \"placeholderImageUrl\", \"placeholderSpinner\", \"placeholderSpinnerDisabled\", \"placeholderProps\", \"embedPlaceholder\", \"placeholderDisabled\", \"scriptLoadDisabled\", \"retryDelay\", \"retryDisabled\", \"frame\", \"debug\"]);\n  var _react_1$default$useS = react_1.default.useState(PROCESS_EMBED_STAGE),\n    _react_1$default$useS2 = _slicedToArray(_react_1$default$useS, 2),\n    stage = _react_1$default$useS2[0],\n    setStage = _react_1$default$useS2[1];\n  var uuidRef = react_1.default.useRef((0, uuid_1.generateUUID)());\n  var _react_1$default$useS3 = react_1.default.useState(Date.now()),\n    _react_1$default$useS4 = _slicedToArray(_react_1$default$useS3, 2),\n    processTime = _react_1$default$useS4[0],\n    setProcessTime = _react_1$default$useS4[1];\n  var embedContainerKey = react_1.default.useMemo(function () {\n    return \"\".concat(uuidRef.current, \"-\").concat(processTime);\n  }, [processTime]);\n  var frm = (0, useFrame_1.useFrame)(frame);\n  // Debug Output\n  react_1.default.useEffect(function () {\n    debug && console.log(\"[\".concat(new Date().toISOString(), \"]: \").concat(stage));\n  }, [debug, stage]);\n  // === === === === === === === === === === === === === === === === === === ===\n  // Embed Stages\n  // === === === === === === === === === === === === === === === === === === ===\n  // Process Embed Stage\n  react_1.default.useEffect(function () {\n    if (stage === PROCESS_EMBED_STAGE) {\n      if (frm.document && !scriptLoadDisabled) {\n        var scriptId = \"tiktok-embed-script\";\n        var prevScript = frm.document.getElementById(scriptId);\n        if (prevScript) {\n          prevScript.remove();\n        }\n        var scriptElement = frm.document.createElement('script');\n        scriptElement.setAttribute('src', \"\".concat(embedJsScriptSrc, \"?t=\").concat(Date.now()));\n        scriptElement.setAttribute('id', scriptId);\n        frm.document.head.appendChild(scriptElement);\n        setStage(CONFIRM_EMBED_SUCCESS_STAGE);\n      }\n    }\n  }, [scriptLoadDisabled, stage, frm.document]);\n  // Confirm Embed Success Stage\n  react_1.default.useEffect(function () {\n    var subs = new react_sub_unsub_1.Subs();\n    if (stage === CONFIRM_EMBED_SUCCESS_STAGE) {\n      subs.setInterval(function () {\n        if (frm.document) {\n          var preEmbedElement = frm.document.getElementById(uuidRef.current);\n          if (!preEmbedElement) {\n            setStage(EMBED_SUCCESS_STAGE);\n          }\n        }\n      }, 1);\n      if (!retryDisabled) {\n        subs.setTimeout(function () {\n          setStage(RETRYING_STAGE);\n        }, retryDelay);\n      }\n    }\n    return subs.createCleanup();\n  }, [retryDelay, retryDisabled, stage, frm.document]);\n  // Retrying Stage\n  react_1.default.useEffect(function () {\n    if (stage === RETRYING_STAGE) {\n      // This forces the embed container to remount\n      setProcessTime(Date.now());\n      setStage(PROCESS_EMBED_STAGE);\n    }\n  }, [stage]);\n  // END Embed Stages\n  // === === === === === === === === === === === === === === === === === === ===\n  // Format: https://www.tiktok.com/@epicgardening/video/7055411162212633903?is_copy_url=1&is_from_webapp=v1\n  var embedId = url.replace(/[?].*$/, '').replace(/^.+\\//, '');\n  // === Placeholder ===\n  var placeholderStyle = {\n    minWidth: minPlaceholderWidth,\n    maxWidth: maxPlaceholderWidth,\n    width: typeof width !== 'undefined' ? width : '100%',\n    height: typeof height !== 'undefined' ? height : typeof ((_b = divProps.style) === null || _b === void 0 ? void 0 : _b.height) !== 'undefined' || typeof ((_c = divProps.style) === null || _c === void 0 ? void 0 : _c.maxHeight) !== 'undefined' ? '100%' : defaultPlaceholderHeight,\n    border: 'solid 1px rgba(22,24,35,0.12)',\n    borderRadius: borderRadius\n  };\n  var placeholder = embedPlaceholder !== null && embedPlaceholder !== void 0 ? embedPlaceholder : react_1.default.createElement(PlaceholderEmbed_1.PlaceholderEmbed, Object.assign({\n    url: url,\n    imageUrl: placeholderImageUrl,\n    linkText: linkText,\n    spinner: placeholderSpinner,\n    spinnerDisabled: placeholderSpinnerDisabled\n  }, placeholderProps, {\n    style: Object.assign(Object.assign({}, placeholderStyle), placeholderProps === null || placeholderProps === void 0 ? void 0 : placeholderProps.style)\n  }));\n  // === END Placeholder ===\n  return react_1.default.createElement(\"div\", Object.assign({}, divProps, {\n    className: (0, classnames_1.default)('rsme-embed rsme-tiktok-embed', divProps.className),\n    style: Object.assign({\n      overflow: 'hidden',\n      width: width !== null && width !== void 0 ? width : undefined,\n      height: height !== null && height !== void 0 ? height : undefined,\n      borderRadius: borderRadius\n    }, divProps.style)\n  }), react_1.default.createElement(EmbedStyle_1.EmbedStyle, null), react_1.default.createElement(\"div\", {\n    className: \"tiktok-embed-container\"\n  }, react_1.default.createElement(\"blockquote\", {\n    key: embedContainerKey,\n    className: \"tiktok-embed\",\n    cite: url,\n    \"data-video-id\": embedId\n  }, !placeholderDisabled ? react_1.default.createElement(\"div\", {\n    id: uuidRef.current,\n    style: {\n      display: 'flex',\n      justifyContent: 'center'\n    }\n  }, placeholder) : react_1.default.createElement(\"div\", {\n    id: uuidRef.current,\n    style: {\n      display: 'none'\n    }\n  }, \"\\xA0\"))));\n};\nexports.TikTokEmbed = TikTokEmbed;","map":null,"metadata":{},"sourceType":"script"}